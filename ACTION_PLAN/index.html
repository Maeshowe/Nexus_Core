
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Modular, asynchronous DataLoader framework for financial data">
      
      
      
        <link rel="canonical" href="https://maeshowe.github.io/Nexus_Core/ACTION_PLAN/">
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Action Plan - OmniData Nexus Core</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#action-plan" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OmniData Nexus Core" class="md-header__button md-logo" aria-label="OmniData Nexus Core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OmniData Nexus Core
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Action Plan
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Maeshowe/Nexus_Core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Maeshowe/Nexus_Core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OmniData Nexus Core" class="md-nav__button md-logo" aria-label="OmniData Nexus Core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OmniData Nexus Core
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Maeshowe/Nexus_Core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Maeshowe/Nexus_Core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/dataloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DataLoader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/providers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Providers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/error-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DataLoader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/providers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Providers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/cache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Health
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../TEST_STRATEGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Executive Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Executive Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#milestone-timeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Milestone Timeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reality-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reality Check
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-milestones" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Milestones
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Milestones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#m1-foundation-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        M1: Foundation &amp; Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m2-core-providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        M2: Core Providers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m3-resilience-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        M3: Resilience Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#m4-testing-polish" class="md-nav__link">
    <span class="md-ellipsis">
      
        M4: Testing &amp; Polish
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-task-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Task Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Task Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#t-001-project-setup-and-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-001: Project Setup and Dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-002-configuration-manager-env-loading" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-002: Configuration Manager (.env loading)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-003-http-client-layer-aiohttp-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-003: HTTP Client Layer (aiohttp wrapper)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-004-cache-manager-filesystem-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-004: Cache Manager (filesystem JSON)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-005-health-monitor-metrics-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-005: Health Monitor (metrics tracking)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-006-base-data-provider-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-006: Base Data Provider Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-007-logging-setup-with-api-key-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-007: Logging Setup with API Key Sanitization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-008-fmp-provider-13-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-008: FMP Provider (13 endpoints)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-009-polygon-provider-4-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-009: Polygon Provider (4 endpoints)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-010-fred-provider-32-series-base" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-010: FRED Provider (32 series + base)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-011-provider-integration-tests-mocked-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-011: Provider Integration Tests (mocked HTTP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-012-qos-semaphore-router" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-012: QoS Semaphore Router
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-013-circuit-breaker-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-013: Circuit Breaker Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-014-retry-handler-exponential-backoff-jitter" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-014: Retry Handler (exponential backoff + jitter)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-015-rate-limit-handling-http-429" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-015: Rate Limit Handling (HTTP 429)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-016-dataloader-unified-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-016: DataLoader Unified Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-017-operating-modes-liveread-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-017: Operating Modes (LIVE/READ-ONLY)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-018-resilience-integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-018: Resilience Integration Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-019-unit-test-suite-completion-tier-1-90" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-019: Unit Test Suite Completion (TIER 1 &gt;90%)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-020-e2e-test-scenarios-10-critical-paths" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-020: E2E Test Scenarios (10 critical paths)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-021-security-tests-api-key-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-021: Security Tests (API key sanitization)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-022-coverage-analysis-and-gap-filling" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-022: Coverage Analysis and Gap Filling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-023-cicd-pipeline-setup-github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-023: CI/CD Pipeline Setup (GitHub Actions)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-024-documentation-polish-readme-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-024: Documentation Polish (README, examples)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-025-pre-commit-hooks-secret-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-025: Pre-commit Hooks (secret scanning)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#t-026-manual-smoke-test-with-real-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        T-026: Manual Smoke Test with Real APIs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-technical-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Technical Approach
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-file-structure-target" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. File Structure (Target)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-dependencies-to-install" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Dependencies to Install
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-risk-mitigation" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Risk Mitigation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-quality-checkpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Quality Checkpoints
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Quality Checkpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#per-task" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per Task
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-milestone" class="md-nav__link">
    <span class="md-ellipsis">
      
        Per Milestone
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-m4-complete" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final (M4 Complete)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-commands-for-claude-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Commands for Claude Code
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Commands for Claude Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-setup-t-001" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Setup (T-001)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lint-and-type-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lint and Type Check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coverage-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-commit-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-commit Setup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-definition-of-done" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Definition of Done
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#approval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Approval
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revision-history" class="md-nav__link">
    <span class="md-ellipsis">
      
        Revision History
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-next-steps-post-completion" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Next Steps (Post-Completion)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Next Steps (Post-Completion)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-dokumentacio-kiegeszitese" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1 Dokumentáció kiegészítése
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-csomagolas-es-publikalas" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2 Csomagolás és publikálás
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-integracios-tesztek-valos-api-kkal" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3 Integrációs tesztek valós API-kkal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-tovabbi-fejlesztesek" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.4 További fejlesztések
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-production-hasznalat" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.5 Production használat
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revision-history_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Revision History
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="action-plan">Action Plan<a class="headerlink" href="#action-plan" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>Project:</strong> OmniData Nexus Core
<strong>Version:</strong> 1.0
<strong>Date:</strong> 2026-01-31
<strong>Status:</strong> ✅ COMPLETE
<strong>Created by:</strong> Lead Agent</p>
</blockquote>
<hr />
<h2 id="1-executive-summary">1. Executive Summary<a class="headerlink" href="#1-executive-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Total Tasks</strong></td>
<td>28</td>
</tr>
<tr>
<td><strong>Total Effort</strong></td>
<td>186-248 hours (realistic estimate)</td>
</tr>
<tr>
<td><strong>Duration</strong></td>
<td>5-7 weeks at sustainable pace (8-10 hours/week)</td>
</tr>
<tr>
<td><strong>Sustainable Pace</strong></td>
<td>8-10 hours/week (research-driven, flexible)</td>
</tr>
<tr>
<td><strong>Milestones</strong></td>
<td>4 (Foundation, Core Providers, Resilience, Testing &amp; Polish)</td>
</tr>
</tbody>
</table>
<h3 id="milestone-timeline">Milestone Timeline<a class="headerlink" href="#milestone-timeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Week 1-2        Week 3-4        Week 5-6        Week 7+
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>────────────    ────────────    ────────────    ────────────
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>M1: Foundation  M2: Providers   M3: Resilience  M4: Testing
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>[██████████]    [██████████]    [██████████]    [██████████]
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a> ✅ COMPLETE     ✅ COMPLETE      ✅ COMPLETE      ✅ COMPLETE
</code></pre></div>
<h3 id="final-results">Final Results<a class="headerlink" href="#final-results" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Actual</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tests</strong></td>
<td>~200</td>
<td>441</td>
</tr>
<tr>
<td><strong>Coverage</strong></td>
<td>&gt;80%</td>
<td>92%</td>
</tr>
<tr>
<td><strong>TIER 1 Coverage</strong></td>
<td>&gt;90%</td>
<td>95-99%</td>
</tr>
<tr>
<td><strong>CI/CD</strong></td>
<td>GitHub Actions</td>
<td>✅ Configured</td>
</tr>
</tbody>
</table>
<h3 id="reality-check">Reality Check<a class="headerlink" href="#reality-check" title="Permanent link">&para;</a></h3>
<p>This is a realistic timeline for a solo developer working 8-10 hours per week on a research tool with no hard deadlines. Effort estimates include:
- Actual coding time
- Testing time (not just "add tests later")
- Debugging and iteration
- Documentation updates
- Learning curve for new patterns</p>
<p><strong>Critical Path:</strong> M1 → M2 → M3 → M4 (sequential dependencies)</p>
<hr />
<h2 id="2-milestones">2. Milestones<a class="headerlink" href="#2-milestones" title="Permanent link">&para;</a></h2>
<h3 id="m1-foundation-infrastructure">M1: Foundation &amp; Infrastructure<a class="headerlink" href="#m1-foundation-infrastructure" title="Permanent link">&para;</a></h3>
<p><strong>Target:</strong> Week 1-2 (16-20 hours)
<strong>Effort:</strong> 38-52 hours (realistic)
<strong>Status:</strong> ✅ COMPLETE</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Task</th>
<th>Effort</th>
<th>Priority</th>
<th>Deps</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>T-001</td>
<td>Project setup and dependencies</td>
<td>2h</td>
<td>P0</td>
<td>-</td>
<td>☐</td>
</tr>
<tr>
<td>T-002</td>
<td>Configuration manager (.env loading)</td>
<td>4-6h</td>
<td>P0</td>
<td>T-001</td>
<td>☐</td>
</tr>
<tr>
<td>T-003</td>
<td>HTTP client layer (aiohttp wrapper)</td>
<td>6-8h</td>
<td>P0</td>
<td>T-001</td>
<td>☐</td>
</tr>
<tr>
<td>T-004</td>
<td>Cache manager (filesystem JSON)</td>
<td>8-12h</td>
<td>P0</td>
<td>T-001</td>
<td>☐</td>
</tr>
<tr>
<td>T-005</td>
<td>Health monitor (metrics tracking)</td>
<td>6-8h</td>
<td>P0</td>
<td>T-001</td>
<td>☐</td>
</tr>
<tr>
<td>T-006</td>
<td>Base data provider interface</td>
<td>6-8h</td>
<td>P0</td>
<td>T-003</td>
<td>☐</td>
</tr>
<tr>
<td>T-007</td>
<td>Logging setup with API key sanitization</td>
<td>6-8h</td>
<td>P0</td>
<td>T-002</td>
<td>☐</td>
</tr>
</tbody>
</table>
<p><strong>Success Criteria:</strong>
- [ ] Project structure created (<code>src/data_loader/</code>, <code>tests/</code>, <code>docs/</code>, <code>data/</code>)
- [ ] Dependencies installed (aiohttp, python-dotenv, pytest)
- [ ] .env.example created with placeholder keys
- [ ] Cache manager can write/read JSON atomically
- [ ] Health monitor tracks basic counters
- [ ] BaseDataProvider abstract class defined
- [ ] API keys sanitized in all log output</p>
<p><strong>Deliverables:</strong>
- Working project skeleton
- Passing lint (ruff/flake8) and type checks (mypy)
- Basic unit tests for config, cache, health monitor
- Documentation: README.md with setup instructions</p>
<hr />
<h3 id="m2-core-providers">M2: Core Providers<a class="headerlink" href="#m2-core-providers" title="Permanent link">&para;</a></h3>
<p><strong>Target:</strong> Week 3-4 (16-20 hours)
<strong>Effort:</strong> 64-88 hours (realistic)
<strong>Status:</strong> ✅ COMPLETE</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Task</th>
<th>Effort</th>
<th>Priority</th>
<th>Deps</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>T-008</td>
<td>FMP provider (13 endpoints)</td>
<td>24-32h</td>
<td>P0</td>
<td>T-006</td>
<td>☐</td>
</tr>
<tr>
<td>T-009</td>
<td>Polygon provider (4 endpoints)</td>
<td>12-16h</td>
<td>P0</td>
<td>T-006</td>
<td>☐</td>
</tr>
<tr>
<td>T-010</td>
<td>FRED provider (32 series + base)</td>
<td>16-24h</td>
<td>P0</td>
<td>T-006</td>
<td>☐</td>
</tr>
<tr>
<td>T-011</td>
<td>Provider integration tests (mocked HTTP)</td>
<td>12-16h</td>
<td>P0</td>
<td>T-008,009,010</td>
<td>☐</td>
</tr>
</tbody>
</table>
<p><strong>Success Criteria:</strong>
- [ ] FMP provider supports all 13 endpoints (screener, profile, quote, historical_price, earnings_calendar, balance_sheet, income_statement, cash_flow, ratios, growth, key_metrics, insider_trading, institutional_ownership)
- [ ] Polygon provider supports 4 endpoints (aggs_daily, trades, options_snapshot, market_snapshot)
- [ ] FRED provider supports 32 series + base API
- [ ] All providers normalize responses to consistent format
- [ ] Cache keys generated correctly per provider strategy
- [ ] Integration tests passing with aioresponses mocks
- [ ] Provider-specific error handling (429, 5xx, timeouts)</p>
<p><strong>Deliverables:</strong>
- 3 working provider implementations
- ~40 integration tests (provider + HTTP mocking)
- JSON fixtures in <code>tests/fixtures/{fmp,polygon,fred}/</code>
- Provider documentation with endpoint examples</p>
<p><strong>Technical Notes:</strong>
- FMP is the most complex (13 endpoints, varying response structures)
- FRED has 32 series but simpler endpoint pattern
- Polygon has date range complexity for aggregates
- Mock all HTTP responses using aioresponses library</p>
<hr />
<h3 id="m3-resilience-layer">M3: Resilience Layer<a class="headerlink" href="#m3-resilience-layer" title="Permanent link">&para;</a></h3>
<p><strong>Target:</strong> Week 5-6 (16-20 hours)
<strong>Effort:</strong> 52-72 hours (realistic)
<strong>Status:</strong> ✅ COMPLETE</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Task</th>
<th>Effort</th>
<th>Priority</th>
<th>Deps</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>T-012</td>
<td>QoS Semaphore Router</td>
<td>8-12h</td>
<td>P0</td>
<td>T-006</td>
<td>☐</td>
</tr>
<tr>
<td>T-013</td>
<td>Circuit Breaker Manager</td>
<td>12-16h</td>
<td>P0</td>
<td>T-005</td>
<td>☐</td>
</tr>
<tr>
<td>T-014</td>
<td>Retry handler (exponential backoff + jitter)</td>
<td>8-12h</td>
<td>P0</td>
<td>T-003</td>
<td>☐</td>
</tr>
<tr>
<td>T-015</td>
<td>Rate limit handling (HTTP 429)</td>
<td>6-8h</td>
<td>P0</td>
<td>T-014</td>
<td>☐</td>
</tr>
<tr>
<td>T-016</td>
<td>DataLoader unified interface</td>
<td>10-14h</td>
<td>P0</td>
<td>T-012,013,014</td>
<td>☐</td>
</tr>
<tr>
<td>T-017</td>
<td>Operating modes (LIVE/READ-ONLY)</td>
<td>4-6h</td>
<td>P0</td>
<td>T-016</td>
<td>☐</td>
</tr>
<tr>
<td>T-018</td>
<td>Resilience integration tests</td>
<td>4-8h</td>
<td>P0</td>
<td>T-012,013,014</td>
<td>☐</td>
</tr>
</tbody>
</table>
<p><strong>Success Criteria:</strong>
- [ ] QoS Router enforces concurrency: FMP=3, Polygon=10, FRED=1
- [ ] Circuit Breaker opens at &gt;20% error rate
- [ ] Circuit Breaker recovery flow: OPEN → HALF-OPEN → CLOSED
- [ ] Exponential backoff: ~1s, ~2s, ~4s with jitter
- [ ] Retry only on 5xx/timeout (not 4xx)
- [ ] HTTP 429 handling: parse Retry-After header
- [ ] DataLoader orchestrates all resilience components
- [ ] READ-ONLY mode prevents API calls (cache-only)
- [ ] LIVE mode normal operation
- [ ] Integration tests validate state machine transitions</p>
<p><strong>Deliverables:</strong>
- QoS router with per-provider semaphores
- Circuit breaker with 3-state FSM
- Retry handler with backoff calculator
- DataLoader unified interface
- ~30 unit tests for resilience components
- ~15 integration tests for orchestration</p>
<p><strong>Technical Notes:</strong>
- Circuit Breaker is TIER 1 (&gt;90% coverage required)
- QoS Router is TIER 1 (&gt;90% coverage required)
- Use asyncio.Semaphore for concurrency control
- Store circuit breaker state in-memory (no persistence)
- DataLoader is the main entry point for consumers</p>
<hr />
<h3 id="m4-testing-polish">M4: Testing &amp; Polish<a class="headerlink" href="#m4-testing-polish" title="Permanent link">&para;</a></h3>
<p><strong>Target:</strong> Week 7+ (variable)
<strong>Effort:</strong> 32-36 hours (realistic)
<strong>Status:</strong> ✅ COMPLETE</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Task</th>
<th>Effort</th>
<th>Priority</th>
<th>Deps</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>T-019</td>
<td>Unit test suite completion (TIER 1 &gt;90%)</td>
<td>12-16h</td>
<td>P0</td>
<td>All</td>
<td>☐</td>
</tr>
<tr>
<td>T-020</td>
<td>E2E test scenarios (10 critical paths)</td>
<td>8-12h</td>
<td>P0</td>
<td>T-016</td>
<td>☐</td>
</tr>
<tr>
<td>T-021</td>
<td>Security tests (API key sanitization)</td>
<td>4-6h</td>
<td>P0</td>
<td>T-007</td>
<td>☐</td>
</tr>
<tr>
<td>T-022</td>
<td>Coverage analysis and gap filling</td>
<td>4-6h</td>
<td>P0</td>
<td>T-019,020</td>
<td>☐</td>
</tr>
<tr>
<td>T-023</td>
<td>CI/CD pipeline setup (GitHub Actions)</td>
<td>4-6h</td>
<td>P1</td>
<td>T-022</td>
<td>☐</td>
</tr>
<tr>
<td>T-024</td>
<td>Documentation polish (README, examples)</td>
<td>6-8h</td>
<td>P1</td>
<td>All</td>
<td>☐</td>
</tr>
<tr>
<td>T-025</td>
<td>Pre-commit hooks (secret scanning)</td>
<td>2-3h</td>
<td>P1</td>
<td>T-007</td>
<td>☐</td>
</tr>
<tr>
<td>T-026</td>
<td>Manual smoke test with real APIs</td>
<td>2-3h</td>
<td>P1</td>
<td>All</td>
<td>☐</td>
</tr>
</tbody>
</table>
<p><strong>Success Criteria:</strong>
- [ ] Overall coverage &gt;80% (pytest-cov)
- [ ] TIER 1 coverage &gt;90% (circuit_breaker, qos_router, sanitization, cache atomic)
- [ ] All ~200 tests passing
- [ ] Test execution time &lt;2 minutes
- [ ] TC-001 through TC-106 passing (critical test cases)
- [ ] No API keys in logs/cache/git (security tests)
- [ ] CI pipeline green
- [ ] README.md with setup instructions &lt;5 minutes
- [ ] Working examples in <code>examples/</code> directory
- [ ] Pre-commit hook blocks commits with secrets
- [ ] Manual validation: fetch real data from all 3 providers</p>
<p><strong>Deliverables:</strong>
- ~150 unit tests
- ~10 E2E tests
- ~10 security tests
- Coverage reports (HTML + terminal)
- CI/CD pipeline (.github/workflows/)
- Pre-commit configuration
- Updated README.md
- Example usage scripts
- Manual test report</p>
<p><strong>Technical Notes:</strong>
- This is where the effort multiplier really applies
- "Add tests" is never quick - expect 8-16h minimum
- Coverage gap filling is detective work (2-4h)
- E2E tests need careful orchestration (mocking all providers)</p>
<hr />
<h2 id="3-task-details">3. Task Details<a class="headerlink" href="#3-task-details" title="Permanent link">&para;</a></h2>
<h3 id="t-001-project-setup-and-dependencies">T-001: Project Setup and Dependencies<a class="headerlink" href="#t-001-project-setup-and-dependencies" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>2 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Create project directory structure, initialize git repository, set up Python virtual environment, and install core dependencies.</p>
<p><strong>Implementation Steps:</strong>
1. Create directory structure matching architecture design
2. Initialize git repository with .gitignore
3. Create Python virtual environment (Python 3.9+)
4. Create requirements.txt with pinned versions
5. Create requirements-dev.txt for development dependencies
6. Create .env.example with placeholder API keys
7. Create basic README.md</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Directory structure exists: <code>src/data_loader/</code>, <code>tests/</code>, <code>docs/</code>, <code>data/</code>, <code>logs/</code>
- [ ] Virtual environment activated
- [ ] Dependencies installed: aiohttp&gt;=3.8, python-dotenv&gt;=0.19
- [ ] Dev dependencies: pytest&gt;=7.0, pytest-cov&gt;=3.0, pytest-asyncio&gt;=0.21, aioresponses&gt;=0.7, mypy&gt;=1.0, ruff
- [ ] .gitignore includes: <code>.env</code>, <code>__pycache__</code>, <code>*.pyc</code>, <code>venv/</code>, <code>data/*</code>, <code>logs/*</code>, <code>.mypy_cache/</code>, <code>.pytest_cache/</code>, <code>htmlcov/</code>
- [ ] .env.example created with: <code>FMP_KEY=your_fmp_key_here</code>, <code>POLYGON_KEY=</code>, <code>FRED_KEY=</code>
- [ ] README.md has installation instructions</p>
<p><strong>Files to Create:</strong>
- <code>requirements.txt</code>
- <code>requirements-dev.txt</code>
- <code>.gitignore</code>
- <code>.env.example</code>
- <code>README.md</code>
- <code>src/data_loader/__init__.py</code>
- <code>tests/conftest.py</code></p>
<p><strong>Commands:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Create project structure</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>src/data_loader/providers<span class="w"> </span>tests/<span class="o">{</span>unit,integration,e2e,fixtures<span class="o">}</span><span class="w"> </span>docs<span class="w"> </span>data<span class="w"> </span>logs
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># Initialize git</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>git<span class="w"> </span>init
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1"># (create .gitignore first)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>git<span class="w"> </span>add<span class="w"> </span>.
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Initial project structure&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># Create virtual environment</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>python3.9<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="nb">source</span><span class="w"> </span>venv/bin/activate
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="c1"># Install dependencies</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements-dev.txt
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c1"># Verify installation</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import aiohttp; import dotenv; print(&#39;Dependencies OK&#39;)&quot;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>pytest<span class="w"> </span>--version
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>mypy<span class="w"> </span>--version
</code></pre></div></p>
<hr />
<h3 id="t-002-configuration-manager-env-loading">T-002: Configuration Manager (.env loading)<a class="headerlink" href="#t-002-configuration-manager-env-loading" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>4-6 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-001</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement configuration manager that loads API keys and settings from environment variables (.env file). Includes validation, defaults, and error handling for missing keys.</p>
<p><strong>Implementation Notes:</strong>
- Use python-dotenv for .env loading
- Separate required keys (API keys) from optional settings (TTL, timeouts)
- Validate keys at startup (not empty strings)
- Provide sensible defaults for non-secret settings
- Support environment variable override (for CI)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Config loads from .env file if present
- [ ] Config loads from environment variables (higher priority than .env)
- [ ] Missing required keys raise ConfigError at startup
- [ ] Optional settings have defaults: <code>CACHE_TTL_DAYS=7</code>, <code>MAX_RETRIES=3</code>, <code>CIRCUIT_BREAKER_THRESHOLD=0.2</code>
- [ ] Config is a singleton (single instance per process)
- [ ] Unit tests verify: .env parsing, defaults, validation, missing keys error</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/config.py</code>
- <code>tests/unit/test_config_manager.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># src/data_loader/config.py</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        <span class="n">load_dotenv</span><span class="p">()</span>  <span class="c1"># Load from .env file</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="c1"># Required API keys</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fmp_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_required</span><span class="p">(</span><span class="s2">&quot;FMP_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">polygon_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_required</span><span class="p">(</span><span class="s2">&quot;POLYGON_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fred_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_required</span><span class="p">(</span><span class="s2">&quot;FRED_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>        <span class="c1"># Optional settings with defaults</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_ttl_days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CACHE_TTL_DAYS&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">))</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAX_RETRIES&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">))</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">circuit_breaker_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CIRCUIT_BREAKER_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2&quot;</span><span class="p">))</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        <span class="c1"># ... more settings</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>            <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required environment variable </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not set&quot;</span><span class="p">)</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="k">return</span> <span class="n">value</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="c1"># Singleton pattern</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="n">_config_instance</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>    <span class="k">global</span> <span class="n">_config_instance</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    <span class="k">if</span> <span class="n">_config_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="n">_config_instance</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    <span class="k">return</span> <span class="n">_config_instance</span>
</code></pre></div></p>
<hr />
<h3 id="t-003-http-client-layer-aiohttp-wrapper">T-003: HTTP Client Layer (aiohttp wrapper)<a class="headerlink" href="#t-003-http-client-layer-aiohttp-wrapper" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>6-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-001</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Create async HTTP client wrapper around aiohttp.ClientSession with timeout management, connection pooling, TLS enforcement, and request/response logging.</p>
<p><strong>Implementation Notes:</strong>
- Enforce HTTPS only (reject http:// URLs)
- Configure timeouts: connect=5s, read=30s, total=60s
- Connection pooling: limit=100 per host
- Timeout error handling (aiohttp.ClientTimeout)
- Request/response logging (sanitize URLs with API keys)
- Session reuse (long-lived ClientSession)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] HTTP client enforces HTTPS (raises error for http://)
- [ ] Configurable timeouts per request
- [ ] Connection pooling configured
- [ ] TLS certificate validation enabled
- [ ] Request logging includes: method, URL (sanitized), status code
- [ ] Response logging includes: status, headers (selected), body size
- [ ] Error handling for: timeout, connection errors, TLS errors
- [ ] Unit tests verify: HTTPS enforcement, timeout config, error handling</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/http_client.py</code>
- <code>tests/unit/test_http_client.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># src/data_loader/http_client.py</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">HTTPClient</span><span class="p">:</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="ow">or</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>            <span class="n">total</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sock_read</span><span class="o">=</span><span class="mi">30</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="p">)</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">:</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>            <span class="n">connector</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>                <span class="n">connector</span><span class="o">=</span><span class="n">connector</span><span class="p">,</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>            <span class="p">)</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_enforce_https</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>            <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_enforce_https</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">):</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTPS required, got: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<h3 id="t-004-cache-manager-filesystem-json">T-004: Cache Manager (filesystem JSON)<a class="headerlink" href="#t-004-cache-manager-filesystem-json" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>8-12 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-001</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement cache manager with atomic writes (temp + rename pattern), TTL expiration, provider-specific directory structure, and JSON serialization. This is TIER 1 (&gt;90% coverage required).</p>
<p><strong>Implementation Notes:</strong>
- Atomic writes: write to temp file → rename to final path (prevents corruption)
- Provider-specific paths: <code>data/fmp_cache/{endpoint}/{date}/{symbol}.json</code>
- Cache key generation: MD5 hash of (provider, endpoint, params)
- TTL check: compare file mtime to current time
- Thread-safe file operations (though system is single-process)
- Validate JSON before write (catch serialization errors early)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Atomic write pattern: temp file created first, renamed on success
- [ ] TTL expiration: files older than TTL considered stale (return None)
- [ ] Provider-specific directory creation (auto-create if missing)
- [ ] Cache key generation consistent (same params → same key)
- [ ] get_cached() returns None for: missing file, expired TTL, corrupted JSON
- [ ] set_cache() rollback: temp file deleted if error during write
- [ ] Unit tests verify: atomic writes, TTL expiration, concurrent writes (mock), error rollback
- [ ] &gt;90% test coverage (TIER 1)</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/cache.py</code>
- <code>tests/unit/test_cache_manager.py</code>
- <code>tests/integration/test_cache_filesystem.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># src/data_loader/cache.py</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">CacheManager</span><span class="p">:</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">ttl_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">):</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ttl_seconds</span> <span class="o">=</span> <span class="n">ttl_days</span> <span class="o">*</span> <span class="mi">86400</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_cached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>        <span class="n">cache_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_path</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>        <span class="c1"># Check TTL</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>        <span class="n">mtime</span> <span class="o">=</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>        <span class="n">age_seconds</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">-</span> <span class="n">mtime</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>        <span class="k">if</span> <span class="n">age_seconds</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttl_seconds</span><span class="p">:</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>        <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>        <span class="n">cache_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_path</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>        <span class="n">cache_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>        <span class="c1"># Atomic write: temp file + rename</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>        <span class="n">temp_path</span> <span class="o">=</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.tmp&#39;</span><span class="p">)</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>            <span class="n">temp_path</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>  <span class="c1"># Atomic on POSIX</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>            <span class="k">if</span> <span class="n">temp_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>                <span class="n">temp_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>  <span class="c1"># Cleanup temp file</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>            <span class="k">raise</span> <span class="n">CacheWriteError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache write failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>        <span class="c1"># Provider-specific path strategy</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">_cache&quot;</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">.json&quot;</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_cache_key</span><span class="p">(</span><span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>        <span class="c1"># MD5 hash for consistent keys</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>        <span class="n">key_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">key_data</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<h3 id="t-005-health-monitor-metrics-tracking">T-005: Health Monitor (metrics tracking)<a class="headerlink" href="#t-005-health-monitor-metrics-tracking" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>6-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-001</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement health monitor to track per-provider metrics: request counts, error counts, error rate, rate limit consumption, circuit breaker state. Provides aggregated health report.</p>
<p><strong>Implementation Notes:</strong>
- In-memory counters (no persistence)
- Per-provider metrics (separate counters for FMP, Polygon, FRED)
- Thread-safe increments (though system is single-process async)
- Error rate calculation: errors / total_requests
- Reset method for testing
- Health report format: JSON-serializable dict</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Track per-provider: total_requests, error_count, last_error_message
- [ ] Calculate error_rate dynamically
- [ ] Store circuit_state (external update from CircuitBreaker)
- [ ] get_health_report() returns dict with all provider stats
- [ ] reset() clears all counters (for testing)
- [ ] Unit tests verify: counter increments, error rate calculation, reset</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/health.py</code>
- <code>tests/unit/test_health_monitor.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># src/data_loader/health.py</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">HealthMonitor</span><span class="p">:</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>            <span class="s1">&#39;fmp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;last_error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;circuit_state&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">},</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>            <span class="s1">&#39;polygon&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;last_error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;circuit_state&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">},</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>            <span class="s1">&#39;fred&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;last_error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;circuit_state&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">},</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="p">}</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">provider</span><span class="p">][</span><span class="s1">&#39;requests&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">provider</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">provider</span><span class="p">][</span><span class="s1">&#39;last_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_message</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_circuit_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">provider</span><span class="p">][</span><span class="s1">&#39;circuit_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_health_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;providers&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>        <span class="k">for</span> <span class="n">provider</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>            <span class="n">total</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;requests&#39;</span><span class="p">]</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>            <span class="n">errors</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>            <span class="n">error_rate</span> <span class="o">=</span> <span class="n">errors</span> <span class="o">/</span> <span class="n">total</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>            <span class="n">report</span><span class="p">[</span><span class="s1">&#39;providers&#39;</span><span class="p">][</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>                <span class="s1">&#39;total_requests&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>                <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="n">errors</span><span class="p">,</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>                <span class="s1">&#39;error_rate&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">error_rate</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>                <span class="s1">&#39;circuit_state&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;circuit_state&#39;</span><span class="p">],</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>                <span class="s1">&#39;last_error&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;last_error&#39;</span><span class="p">]</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>            <span class="p">}</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>        <span class="k">return</span> <span class="n">report</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>        <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">:</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;last_error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;circuit_state&#39;</span><span class="p">:</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">}</span>
</code></pre></div></p>
<hr />
<h3 id="t-006-base-data-provider-interface">T-006: Base Data Provider Interface<a class="headerlink" href="#t-006-base-data-provider-interface" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>6-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-003</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Define abstract base class for data providers with template methods for authentication, fetching, normalization, and cache key generation. Enables plugin architecture for future providers.</p>
<p><strong>Implementation Notes:</strong>
- Use Python ABC (Abstract Base Class)
- Template method pattern: fetch() orchestrates auth → request → normalize
- Abstract methods: _authenticate(), _make_request(), _normalize_response()
- Concrete methods: fetch(), generate_cache_key()
- Type hints for all methods
- Docstrings with examples</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] BaseDataProvider is abstract (cannot instantiate)
- [ ] Abstract methods defined: _authenticate(), _make_request(), _normalize_response()
- [ ] fetch() template method orchestrates workflow
- [ ] generate_cache_key() concrete implementation
- [ ] Type hints for all parameters and returns
- [ ] Google-style docstrings
- [ ] Unit tests verify: abstract enforcement, template method flow</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/providers/base.py</code>
- <code>src/data_loader/providers/__init__.py</code>
- <code>tests/unit/test_base_provider.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># src/data_loader/providers/base.py</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseDataProvider</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="sd">    Abstract base class for data providers.</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="sd">    Subclasses must implement:</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="sd">    - _authenticate(): Return authentication parameters (headers, query params)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="sd">    - _make_request(): Execute HTTP request and return raw response</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="sd">    - _normalize_response(): Transform provider-specific response to standard format</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="sd">    Example:</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="sd">        class FMPProvider(BaseDataProvider):</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="sd">            def _authenticate(self):</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="sd">                return {&#39;apikey&#39;: self.api_key}</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="sd">            def _make_request(self, endpoint, params):</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="sd">                url = f&quot;{self.base_url}/{endpoint}&quot;</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="sd">                return await self.http_client.get(url, params={**params, **self._authenticate()})</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">http_client</span><span class="p">):</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">http_client</span> <span class="o">=</span> <span class="n">http_client</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="sd">        Fetch data from provider endpoint.</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="sd">        Template method that orchestrates:</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="sd">        1. Authentication</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="sd">        2. HTTP request</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="sd">        3. Response normalization</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>        <span class="n">auth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">()</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>        <span class="n">raw_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="p">{</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">auth_params</span><span class="p">})</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_response</span><span class="p">(</span><span class="n">raw_response</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>        <span class="k">return</span> <span class="n">normalized</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return authentication parameters (headers or query params).&quot;&quot;&quot;</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>        <span class="k">pass</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_make_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute HTTP request and return raw JSON response.&quot;&quot;&quot;</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>        <span class="k">pass</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform provider-specific response to standard format.&quot;&quot;&quot;</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>        <span class="k">pass</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate consistent cache key from endpoint and parameters.&quot;&quot;&quot;</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>        <span class="n">key_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">key_data</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<h3 id="t-007-logging-setup-with-api-key-sanitization">T-007: Logging Setup with API Key Sanitization<a class="headerlink" href="#t-007-logging-setup-with-api-key-sanitization" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M1</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>6-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-002</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Configure Python logging with rotating file handler, structured log format, and API key sanitization filter. This is TIER 1 security requirement (&gt;90% coverage).</p>
<p><strong>Implementation Notes:</strong>
- Use Python logging module (standard library)
- Rotating file handler: 10MB max size, 5 backup files
- Log format: timestamp, level, component, message
- Sanitization filter: regex-based key redaction
- Redact patterns: API keys in URLs, headers, error messages
- Replace with: <code>***REDACTED***</code>
- Unit tests verify: keys redacted in all log levels, regex patterns</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Logging configured to file: <code>logs/nexus_core.log</code>
- [ ] Rotating handler: max 10MB, 5 backups
- [ ] Log format includes: timestamp (ISO 8601), level, logger name, message
- [ ] Sanitization filter active on all handlers
- [ ] API keys redacted in: URLs, error messages, debug logs
- [ ] Regex patterns cover: <code>apikey=XXX</code>, <code>api_key=XXX</code>, <code>Authorization: Bearer XXX</code>
- [ ] Unit tests verify: redaction patterns, no keys in output
- [ ] &gt;90% test coverage (TIER 1)</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/logging_config.py</code>
- <code>tests/unit/test_logging_sanitization.py</code>
- <code>tests/integration/test_logging_integration.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># src/data_loader/logging_config.py</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">logging.handlers</span><span class="w"> </span><span class="kn">import</span> <span class="n">RotatingFileHandler</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">APIKeySanitizer</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="p">):</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter to redact API keys from log messages.&quot;&quot;&quot;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="n">PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(apikey|api_key)=[^&amp;\s]+&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;\1=***REDACTED***&#39;</span><span class="p">),</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Authorization:\s*Bearer\s+[^\s]+&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;Authorization: Bearer ***REDACTED***&#39;</span><span class="p">),</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-f0-9]{32,}&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;***REDACTED***&#39;</span><span class="p">),</span>  <span class="c1"># MD5-like keys</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="p">]</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">LogRecord</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        <span class="n">record</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">))</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>            <span class="n">record</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sanitize</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PATTERNS</span><span class="p">:</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">replacement</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>        <span class="k">return</span> <span class="n">message</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span><span class="n">log_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;logs/nexus_core.log&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">):</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure logging with API key sanitization.&quot;&quot;&quot;</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">log_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>    <span class="n">handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>        <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>        <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>    <span class="p">)</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>    <span class="n">handler</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="n">APIKeySanitizer</span><span class="p">())</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>    <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>    <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>    <span class="k">return</span> <span class="n">root_logger</span>
</code></pre></div></p>
<hr />
<h3 id="t-008-fmp-provider-13-endpoints">T-008: FMP Provider (13 endpoints)<a class="headerlink" href="#t-008-fmp-provider-13-endpoints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M2</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>24-32 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-006</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement FMP Ultimate provider with support for 13 endpoints: screener, profile, quote, historical_price, earnings_calendar, balance_sheet, income_statement, cash_flow, ratios, growth, key_metrics, insider_trading, institutional_ownership. Most complex provider due to endpoint variety.</p>
<p><strong>Implementation Notes:</strong>
- Inherit from BaseDataProvider
- Base URL: <code>https://financialmodelingprep.com/api/v3/</code>
- Authentication: <code>apikey</code> query parameter
- Endpoint-specific normalization (each has different schema)
- Cache key strategy: <code>{endpoint}/{date}/{symbol}.json</code>
- Error handling: 429 rate limit, 401 invalid key, 404 not found
- JSON fixtures for testing: record real responses once</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] All 13 endpoints implemented
- [ ] Authentication via <code>apikey</code> query param
- [ ] Normalization handles: missing fields, null values, varying schemas
- [ ] Cache key generation per endpoint
- [ ] Error handling: 401 (bad key), 429 (rate limit), 404 (not found), 5xx (server error)
- [ ] Unit tests per endpoint: normalization logic
- [ ] Integration tests: HTTP mocking with aioresponses
- [ ] JSON fixtures in <code>tests/fixtures/fmp/</code></p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/providers/fmp.py</code>
- <code>tests/unit/test_fmp_provider.py</code>
- <code>tests/integration/test_fmp_integration.py</code>
- <code>tests/fixtures/fmp/profile_AAPL.json</code> (and 12 more)</p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># src/data_loader/providers/fmp.py</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseDataProvider</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">FMPProvider</span><span class="p">(</span><span class="n">BaseDataProvider</span><span class="p">):</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Financial Modeling Prep API provider.&quot;&quot;&quot;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://financialmodelingprep.com/api/v3&quot;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="n">ENDPOINTS</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        <span class="s1">&#39;screener&#39;</span><span class="p">:</span> <span class="s1">&#39;/stock-screener&#39;</span><span class="p">,</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>        <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="s1">&#39;/profile/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="s1">&#39;quote&#39;</span><span class="p">:</span> <span class="s1">&#39;/quote/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>        <span class="s1">&#39;historical_price&#39;</span><span class="p">:</span> <span class="s1">&#39;/historical-price-full/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>        <span class="s1">&#39;earnings_calendar&#39;</span><span class="p">:</span> <span class="s1">&#39;/earnings-calendar/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>        <span class="s1">&#39;balance_sheet&#39;</span><span class="p">:</span> <span class="s1">&#39;/balance-sheet-statement/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>        <span class="s1">&#39;income_statement&#39;</span><span class="p">:</span> <span class="s1">&#39;/income-statement/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>        <span class="s1">&#39;cash_flow&#39;</span><span class="p">:</span> <span class="s1">&#39;/cash-flow-statement/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>        <span class="s1">&#39;ratios&#39;</span><span class="p">:</span> <span class="s1">&#39;/ratios/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>        <span class="s1">&#39;growth&#39;</span><span class="p">:</span> <span class="s1">&#39;/financial-growth/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>        <span class="s1">&#39;key_metrics&#39;</span><span class="p">:</span> <span class="s1">&#39;/key-metrics/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>        <span class="s1">&#39;insider_trading&#39;</span><span class="p">:</span> <span class="s1">&#39;/insider-trading/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>        <span class="s1">&#39;institutional_ownership&#39;</span><span class="p">:</span> <span class="s1">&#39;/institutional-holder/</span><span class="si">{symbol}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    <span class="p">}</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;apikey&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">}</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_make_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>        <span class="c1"># Replace {symbol} in path</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENDPOINTS</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">BASE_URL</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>        <span class="c1"># Add authentication</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">()}</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>        <span class="n">query_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Symbol already in path</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_params</span><span class="p">)</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>        <span class="c1"># Endpoint-specific normalization</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>        <span class="k">if</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;profile&#39;</span><span class="p">:</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_profile</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>        <span class="k">elif</span> <span class="n">endpoint</span> <span class="o">==</span> <span class="s1">&#39;quote&#39;</span><span class="p">:</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_quote</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>        <span class="c1"># ... more endpoints</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>        <span class="k">return</span> <span class="n">response</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>        <span class="c1"># Handle both single object and array responses</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{}</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>            <span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">),</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>            <span class="s1">&#39;company_name&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;companyName&#39;</span><span class="p">),</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>            <span class="s1">&#39;sector&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sector&#39;</span><span class="p">),</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>            <span class="s1">&#39;industry&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;industry&#39;</span><span class="p">),</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>            <span class="s1">&#39;market_cap&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mktCap&#39;</span><span class="p">),</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>            <span class="c1"># ... more fields</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>        <span class="p">}</span>
</code></pre></div></p>
<p><strong>Effort Breakdown:</strong>
- Base implementation: 6h
- 13 endpoint implementations: 12h (1h each, some simpler)
- Normalization logic: 6h (complex schemas)
- Unit tests: 8h
- Integration tests: 4h
- JSON fixtures: 2h (record from real API)
- Debugging: 2-4h
- <strong>Total: 40-44h (realistic)</strong></p>
<hr />
<h3 id="t-009-polygon-provider-4-endpoints">T-009: Polygon Provider (4 endpoints)<a class="headerlink" href="#t-009-polygon-provider-4-endpoints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M2</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>12-16 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-006</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement Polygon.io provider with 4 endpoints: aggs_daily, trades, options_snapshot, market_snapshot. Simpler than FMP but has date range complexity.</p>
<p><strong>Implementation Notes:</strong>
- Base URL: <code>https://api.polygon.io/v2/</code>
- Authentication: <code>apiKey</code> query parameter
- Date range handling for aggregates (from/to parameters)
- Hash-based cache keys (complex query params)
- Rate limit: 5 req/min (free tier), 10 concurrent (QoS)
- Options endpoint has nested data structures</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] 4 endpoints implemented: aggs_daily, trades, options_snapshot, market_snapshot
- [ ] Authentication via <code>apiKey</code> query param
- [ ] Date range handling for aggs_daily
- [ ] Hash-based cache key for complex params
- [ ] Normalization handles nested structures (options)
- [ ] Unit tests: normalization per endpoint
- [ ] Integration tests: date range edge cases
- [ ] JSON fixtures in <code>tests/fixtures/polygon/</code></p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/providers/polygon.py</code>
- <code>tests/unit/test_polygon_provider.py</code>
- <code>tests/integration/test_polygon_integration.py</code>
- <code>tests/fixtures/polygon/aggs_daily_SPY.json</code> (and 3 more)</p>
<p><strong>Effort Breakdown:</strong>
- Base implementation: 3h
- 4 endpoint implementations: 4h
- Date range logic: 2h
- Normalization: 3h
- Unit tests: 4h
- Integration tests: 2h
- JSON fixtures: 1h
- Debugging: 1-3h
- <strong>Total: 20-22h (realistic)</strong></p>
<hr />
<h3 id="t-010-fred-provider-32-series-base">T-010: FRED Provider (32 series + base)<a class="headerlink" href="#t-010-fred-provider-32-series-base" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M2</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>16-24 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-006</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement FRED (Federal Reserve Economic Data) provider supporting 32 predefined series (CPIAUCSL, UNRATE, DGS10, etc.) plus generic series endpoint.</p>
<p><strong>Implementation Notes:</strong>
- Base URL: <code>https://api.stlouisfed.org/fred/</code>
- Authentication: <code>api_key</code> query parameter
- Series endpoint: <code>/series/observations</code>
- 32 predefined series as constants (see DECISIONS.md Section 14)
- Date range handling (start_date, end_date)
- Time series normalization (date + value pairs)
- Simple endpoint pattern (less variety than FMP)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Generic series fetch supports any series_id
- [ ] 32 predefined series documented (constants or enum)
- [ ] Authentication via <code>api_key</code> query param
- [ ] Date range parameters: observation_start, observation_end
- [ ] Normalization to consistent time series format: <code>[{date, value}, ...]</code>
- [ ] Cache key: <code>fred_cache/{series_id}/{date_range}.json</code>
- [ ] Unit tests: sample series (5-10), normalization
- [ ] Integration tests: date range edge cases
- [ ] JSON fixtures for representative series</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/providers/fred.py</code>
- <code>tests/unit/test_fred_provider.py</code>
- <code>tests/integration/test_fred_integration.py</code>
- <code>tests/fixtures/fred/CPIAUCSL.json</code> (and 5-10 more samples)</p>
<p><strong>Effort Breakdown:</strong>
- Base implementation: 4h
- Series endpoint: 3h
- Date range logic: 2h
- Normalization: 3h
- 32 series constants: 1h
- Unit tests: 6h
- Integration tests: 3h
- JSON fixtures: 2h
- Debugging: 2-4h
- <strong>Total: 26-28h (realistic)</strong></p>
<hr />
<h3 id="t-011-provider-integration-tests-mocked-http">T-011: Provider Integration Tests (mocked HTTP)<a class="headerlink" href="#t-011-provider-integration-tests-mocked-http" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M2</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>12-16 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-008, T-009, T-010</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Create comprehensive integration tests for all 3 providers using aioresponses to mock HTTP responses. Validates provider behavior with realistic mocked API responses.</p>
<p><strong>Implementation Notes:</strong>
- Use aioresponses library to mock aiohttp requests
- Test scenarios: success (200), rate limit (429), server error (5xx), timeout
- Verify provider handles errors correctly
- Validate normalization with realistic response fixtures
- Test retry logic integration (without actual delays)
- Mock circuit breaker interactions</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] ~40 integration tests total (~13 per provider + orchestration)
- [ ] HTTP 200 success scenarios (all endpoints)
- [ ] HTTP 429 rate limit handling
- [ ] HTTP 5xx retry logic
- [ ] Timeout handling
- [ ] Malformed JSON response handling
- [ ] All tests use aioresponses (no real API calls)
- [ ] Tests run in &lt;60 seconds</p>
<p><strong>Files to Create/Extend:</strong>
- <code>tests/integration/test_fmp_integration.py</code>
- <code>tests/integration/test_polygon_integration.py</code>
- <code>tests/integration/test_fred_integration.py</code></p>
<p><strong>Effort Breakdown:</strong>
- FMP integration tests: 5h (13 endpoints)
- Polygon integration tests: 3h (4 endpoints)
- FRED integration tests: 3h (sample series)
- Error scenario tests: 3h (429, 5xx, timeout)
- Debugging flaky tests: 2-4h
- <strong>Total: 16-18h (realistic)</strong></p>
<hr />
<h3 id="t-012-qos-semaphore-router">T-012: QoS Semaphore Router<a class="headerlink" href="#t-012-qos-semaphore-router" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>8-12 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-006</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement QoS (Quality of Service) router with provider-specific semaphores to enforce concurrency limits: FMP=3, Polygon=10, FRED=1. TIER 1 component (&gt;90% coverage).</p>
<p><strong>Implementation Notes:</strong>
- Use asyncio.Semaphore per provider
- Context manager for acquire/release pattern
- Timeout handling (raise error if cannot acquire)
- Configurable limits (from config)
- Log semaphore acquisition/release
- Thread-safe (though system is single async process)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Separate semaphores for FMP (max=3), Polygon (max=10), FRED (max=1)
- [ ] acquire(provider) blocks until semaphore available
- [ ] release(provider) releases semaphore
- [ ] Context manager support: <code>async with qos_router.acquire(provider):</code>
- [ ] Timeout parameter (default 30s)
- [ ] Unit tests verify: concurrency limits enforced, timeout handling
- [ ] &gt;90% test coverage (TIER 1)</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/qos_router.py</code>
- <code>tests/unit/test_qos_router.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># src/data_loader/qos_router.py</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">asynccontextmanager</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncIterator</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">QoSRouter</span><span class="p">:</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Quality of Service router with provider-specific concurrency limits.&quot;&quot;&quot;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmp_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">polygon_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">fred_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_semaphores</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>            <span class="s1">&#39;fmp&#39;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">fmp_limit</span><span class="p">),</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>            <span class="s1">&#39;polygon&#39;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">polygon_limit</span><span class="p">),</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>            <span class="s1">&#39;fred&#39;</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">fred_limit</span><span class="p">),</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="p">}</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="nd">@asynccontextmanager</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="sd">        Acquire semaphore for provider with timeout.</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="sd">        Usage:</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="sd">            async with qos_router.acquire(&#39;fmp&#39;):</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="sd">                # Make API request</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="sd">                pass</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>        <span class="n">semaphore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_semaphores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">semaphore</span><span class="p">:</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown provider: </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>            <span class="k">yield</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>            <span class="k">raise</span> <span class="n">QoSTimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not acquire semaphore for </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2"> within </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>            <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>Effort Breakdown:</strong>
- Implementation: 3h
- Unit tests: 4h (test concurrent scenarios)
- Integration with providers: 2h
- Debugging async edge cases: 1-3h
- <strong>Total: 10-12h (realistic)</strong></p>
<hr />
<h3 id="t-013-circuit-breaker-manager">T-013: Circuit Breaker Manager<a class="headerlink" href="#t-013-circuit-breaker-manager" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>12-16 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-005</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement circuit breaker pattern with 3 states (CLOSED, OPEN, HALF-OPEN) and per-provider failure tracking. Opens at &gt;20% error rate. TIER 1 component (&gt;90% coverage).</p>
<p><strong>Implementation Notes:</strong>
- Finite state machine: CLOSED → OPEN → HALF-OPEN → CLOSED (or back to OPEN)
- Per-provider state (FMP, Polygon, FRED independent)
- Sliding window error tracking (last N requests)
- Threshold: &gt;20% error rate
- Timeout in OPEN state (e.g., 60s before HALF-OPEN)
- HALF-OPEN: single test request, success → CLOSED, failure → OPEN
- Integration with HealthMonitor for state reporting</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] 3 states: CLOSED (normal), OPEN (failing), HALF-OPEN (testing recovery)
- [ ] Per-provider state tracking
- [ ] Error rate threshold: &gt;20% (configurable)
- [ ] Sliding window: last 10 requests (configurable)
- [ ] OPEN timeout: 60s (configurable)
- [ ] HALF-OPEN recovery: 1 test request
- [ ] Raises CircuitOpenError when state=OPEN
- [ ] Unit tests verify: state transitions, threshold calculation, timeout, recovery
- [ ] Integration tests: full state machine cycle
- [ ] &gt;90% test coverage (TIER 1)</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/circuit_breaker.py</code>
- <code>tests/unit/test_circuit_breaker.py</code>
- <code>tests/integration/test_circuit_breaker_integration.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># src/data_loader/circuit_breaker.py</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="n">CLOSED</span> <span class="o">=</span> <span class="s2">&quot;CLOSED&quot;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="n">OPEN</span> <span class="o">=</span> <span class="s2">&quot;OPEN&quot;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="n">HALF_OPEN</span> <span class="o">=</span> <span class="s2">&quot;HALF_OPEN&quot;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">CircuitBreaker</span><span class="p">:</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Per-provider circuit breaker with error rate threshold.&quot;&quot;&quot;</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">timeout_seconds</span><span class="p">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">CircuitState</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>            <span class="s1">&#39;fmp&#39;</span><span class="p">:</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>            <span class="s1">&#39;polygon&#39;</span><span class="p">:</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>            <span class="s1">&#39;fred&#39;</span><span class="p">:</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>        <span class="p">}</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_windows</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">deque</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>            <span class="s1">&#39;fmp&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">window_size</span><span class="p">),</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>            <span class="s1">&#39;polygon&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">window_size</span><span class="p">),</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>            <span class="s1">&#39;fred&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">window_size</span><span class="p">),</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>        <span class="p">}</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_open_times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_windows</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_open_times</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_windows</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>        <span class="n">error_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_error_rate</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>        <span class="k">if</span> <span class="n">error_rate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">OPEN</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_open_times</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">OPEN</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_open_times</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if circuit allows request. Raises CircuitOpenError if OPEN.&quot;&quot;&quot;</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a>        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a>            <span class="c1"># Check if timeout elapsed → HALF_OPEN</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>            <span class="n">open_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_times</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a>            <span class="k">if</span> <span class="n">open_time</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">open_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span> <span class="o">=</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>                <span class="k">raise</span> <span class="n">CircuitOpenError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker OPEN for </span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_error_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a>        <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_windows</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">window</span><span class="p">:</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a>            <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>        <span class="n">failures</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">success</span> <span class="ow">in</span> <span class="n">window</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">)</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a>        <span class="k">return</span> <span class="n">failures</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Effort Breakdown:</strong>
- State machine implementation: 4h
- Error rate tracking: 2h
- Timeout and recovery: 2h
- Integration with HealthMonitor: 1h
- Unit tests: 5h (complex state transitions)
- Integration tests: 2h
- Debugging edge cases: 2-4h
- <strong>Total: 18-20h (realistic)</strong></p>
<hr />
<h3 id="t-014-retry-handler-exponential-backoff-jitter">T-014: Retry Handler (exponential backoff + jitter)<a class="headerlink" href="#t-014-retry-handler-exponential-backoff-jitter" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>8-12 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-003</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement retry logic with exponential backoff and jitter for transient failures (5xx, timeouts). Does NOT retry 4xx errors or 429 rate limits.</p>
<p><strong>Implementation Notes:</strong>
- Exponential backoff: delay = base * (2 ** attempt)
- Jitter: randomize delay ±20% to prevent thundering herd
- Max retries: 3 (configurable)
- Retry only: 5xx errors, timeouts (aiohttp.ClientTimeout)
- Do NOT retry: 4xx errors, 429 (handled separately)
- Log each retry attempt
- Total time budget: ~7-8s max (1s + 2s + 4s)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Exponential backoff: attempt 1 → ~1s, attempt 2 → ~2s, attempt 3 → ~4s
- [ ] Jitter: randomize delay ±20%
- [ ] Max retries: 3 (configurable)
- [ ] Retry only on: 5xx, timeouts
- [ ] Do NOT retry: 4xx, 429
- [ ] Log each retry: attempt number, delay, error
- [ ] Unit tests verify: backoff calculation, jitter range, retry logic, max retries
- [ ] Integration tests: mock 5xx → success on 3rd retry</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/retry.py</code>
- <code>tests/unit/test_retry_handler.py</code>
- <code>tests/integration/test_retry_integration.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># src/data_loader/retry.py</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">RetryHandler</span><span class="p">:</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retry handler with exponential backoff and jitter.&quot;&quot;&quot;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">base_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span> <span class="o">=</span> <span class="n">base_delay</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span> <span class="o">=</span> <span class="n">jitter</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute function with retry logic.&quot;&quot;&quot;</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="n">last_error</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>                <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_retry</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">attempt</span><span class="p">):</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>                    <span class="k">raise</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>                <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>                    <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_delay</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retry </span><span class="si">{</span><span class="n">attempt</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">delay</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>        <span class="k">raise</span> <span class="n">last_error</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if error is retryable.&quot;&quot;&quot;</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>        <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>        <span class="c1"># Retry 5xx and timeouts</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientError</span><span class="p">):</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">):</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>                <span class="k">return</span> <span class="mi">500</span> <span class="o">&lt;=</span> <span class="n">error</span><span class="o">.</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">600</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Timeout</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate delay with exponential backoff and jitter.&quot;&quot;&quot;</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>        <span class="n">jitter_amount</span> <span class="o">=</span> <span class="n">delay</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>        <span class="k">return</span> <span class="n">delay</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">jitter_amount</span><span class="p">,</span> <span class="n">jitter_amount</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Effort Breakdown:</strong>
- Implementation: 3h
- Backoff + jitter logic: 2h
- Unit tests: 4h
- Integration tests: 2h
- Debugging async timing: 1-3h
- <strong>Total: 12-14h (realistic)</strong></p>
<hr />
<h3 id="t-015-rate-limit-handling-http-429">T-015: Rate Limit Handling (HTTP 429)<a class="headerlink" href="#t-015-rate-limit-handling-http-429" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>6-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-014</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Handle HTTP 429 rate limit responses by parsing Retry-After header and sleeping before retry. Separate from exponential backoff logic.</p>
<p><strong>Implementation Notes:</strong>
- Parse Retry-After header (seconds or HTTP date)
- Sleep for specified duration
- Log rate limit hit with cooldown time
- Update HealthMonitor rate_limit_pct
- Do NOT use exponential backoff for 429 (respect server instruction)
- Single retry after cooldown (not multiple)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Detect HTTP 429 response
- [ ] Parse Retry-After header (seconds format)
- [ ] Sleep for Retry-After duration
- [ ] Log rate limit event
- [ ] Single retry after cooldown
- [ ] If Retry-After missing, use default cooldown (60s)
- [ ] Unit tests verify: header parsing, cooldown logic
- [ ] Integration tests: mock 429 → success after cooldown</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/rate_limit.py</code> (or extend retry.py)
- <code>tests/unit/test_rate_limit.py</code>
- <code>tests/integration/test_rate_limit_integration.py</code></p>
<p><strong>Effort Breakdown:</strong>
- Implementation: 2h
- Retry-After parsing: 1h
- Integration with retry handler: 1h
- Unit tests: 2h
- Integration tests: 1h
- Debugging: 1-2h
- <strong>Total: 8-9h (realistic)</strong></p>
<hr />
<h3 id="t-016-dataloader-unified-interface">T-016: DataLoader Unified Interface<a class="headerlink" href="#t-016-dataloader-unified-interface" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>10-14 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-012, T-013, T-014</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement main DataLoader class that orchestrates all components: providers, QoS router, circuit breaker, retry handler, cache. Provides unified interface: <code>get_fmp_data()</code>, <code>get_polygon_data()</code>, <code>get_fred_data()</code>.</p>
<p><strong>Implementation Notes:</strong>
- Singleton or dependency-injected instance
- Orchestration flow: check cache → check circuit → acquire QoS → call provider → handle retries → update cache
- Provider routing: map provider name to provider instance
- Health report aggregation
- Operating mode enforcement (LIVE vs READ-ONLY)
- Session management (long-lived aiohttp.ClientSession)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Methods: <code>get_fmp_data()</code>, <code>get_polygon_data()</code>, <code>get_fred_data()</code>, <code>get_api_health_report()</code>, <code>set_operating_mode()</code>
- [ ] Orchestration: cache → circuit → QoS → provider → retry → cache
- [ ] Cache hit: return immediately (no API call)
- [ ] Circuit OPEN: raise error (no API call)
- [ ] QoS: enforce concurrency limits
- [ ] Retry: handle 5xx and timeouts
- [ ] Rate limit: handle 429
- [ ] Health tracking: update counters per request
- [ ] Operating modes: LIVE (normal), READ-ONLY (cache only)
- [ ] Unit tests: orchestration flow, mode enforcement
- [ ] Integration tests: full request cycle</p>
<p><strong>Files to Create:</strong>
- <code>src/data_loader/loader.py</code>
- <code>tests/unit/test_loader.py</code>
- <code>tests/integration/test_loader_integration.py</code></p>
<p><strong>Implementation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># src/data_loader/loader.py</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.providers.fmp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FMPProvider</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.providers.polygon</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolygonProvider</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.providers.fred</span><span class="w"> </span><span class="kn">import</span> <span class="n">FREDProvider</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">DataLoader</span><span class="p">:</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Unified interface for financial data retrieval.&quot;&quot;&quot;</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">health_monitor</span><span class="p">,</span> <span class="n">circuit_breaker</span><span class="p">,</span> <span class="n">qos_router</span><span class="p">,</span> <span class="n">retry_handler</span><span class="p">):</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health</span> <span class="o">=</span> <span class="n">health_monitor</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="n">circuit_breaker</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="n">qos_router</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="n">retry_handler</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>        <span class="c1"># Initialize providers</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">providers</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>            <span class="s1">&#39;fmp&#39;</span><span class="p">:</span> <span class="n">FMPProvider</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">fmp_key</span><span class="p">,</span> <span class="n">http_client</span><span class="p">),</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>            <span class="s1">&#39;polygon&#39;</span><span class="p">:</span> <span class="n">PolygonProvider</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">polygon_key</span><span class="p">,</span> <span class="n">http_client</span><span class="p">),</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>            <span class="s1">&#39;fred&#39;</span><span class="p">:</span> <span class="n">FREDProvider</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">fred_key</span><span class="p">,</span> <span class="n">http_client</span><span class="p">),</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>        <span class="p">}</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;LIVE&#39;</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_fmp_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch data from FMP provider.&quot;&quot;&quot;</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="s1">&#39;fmp&#39;</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Orchestrate data fetch with all resilience components.&quot;&quot;&quot;</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">providers</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">generate_cache_key</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>        <span class="c1"># 1. Check cache</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_cached</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>            <span class="k">return</span> <span class="n">cached</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>        <span class="c1"># 2. Check mode</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;READ_ONLY&#39;</span><span class="p">:</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>            <span class="k">raise</span> <span class="n">ReadOnlyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;READ-ONLY mode: no API calls allowed&quot;</span><span class="p">)</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>        <span class="c1"># 3. Check circuit breaker</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>        <span class="c1"># 4. Acquire QoS semaphore</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">qos</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">provider</span><span class="p">):</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>                <span class="c1"># 5. Fetch with retry</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">health</span><span class="o">.</span><span class="n">record_request</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">providers</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">,</span>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>                    <span class="n">endpoint</span><span class="p">,</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>                    <span class="o">**</span><span class="n">params</span>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>                <span class="p">)</span>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a>                <span class="c1"># 6. Update cache</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set_cache</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a>                <span class="c1"># 7. Record success</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">record_success</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>                <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">health</span><span class="o">.</span><span class="n">record_error</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">record_failure</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>                <span class="k">raise</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_api_health_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">health</span><span class="o">.</span><span class="n">get_health_report</span><span class="p">()</span>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_operating_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;LIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;READ_ONLY&#39;</span><span class="p">):</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</code></pre></div></p>
<p><strong>Effort Breakdown:</strong>
- Core orchestration: 4h
- Provider integration: 2h
- Mode enforcement: 1h
- Session management: 1h
- Unit tests: 4h
- Integration tests: 3h
- Debugging orchestration: 2-4h
- <strong>Total: 17-19h (realistic)</strong></p>
<hr />
<h3 id="t-017-operating-modes-liveread-only">T-017: Operating Modes (LIVE/READ-ONLY)<a class="headerlink" href="#t-017-operating-modes-liveread-only" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>4-6 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-016</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement operating mode switching: LIVE (normal API calls) and READ-ONLY (cache-only, no API calls). Enables offline analysis and testing.</p>
<p><strong>Implementation Notes:</strong>
- Mode stored in DataLoader state
- LIVE: normal operation (default)
- READ-ONLY: cache hit returns data, cache miss raises error
- set_operating_mode() method validates mode
- Log mode changes
- Unit tests verify mode enforcement</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Modes: LIVE, READ_ONLY
- [ ] LIVE mode: normal behavior (cache → API → cache)
- [ ] READ_ONLY mode: cache hit → data, cache miss → ReadOnlyError
- [ ] set_operating_mode() validates input
- [ ] Log mode changes
- [ ] Unit tests: mode switching, enforcement
- [ ] E2E test: READ-ONLY prevents API calls</p>
<p><strong>Files to Create/Extend:</strong>
- <code>src/data_loader/loader.py</code> (extend)
- <code>tests/unit/test_loader.py</code> (extend)
- <code>tests/e2e/test_readonly_mode.py</code></p>
<p><strong>Effort Breakdown:</strong>
- Implementation: 1h
- Error handling: 1h
- Unit tests: 2h
- E2E tests: 1h
- Debugging: 1-2h
- <strong>Total: 6-7h (realistic)</strong></p>
<hr />
<h3 id="t-018-resilience-integration-tests">T-018: Resilience Integration Tests<a class="headerlink" href="#t-018-resilience-integration-tests" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M3</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>4-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-012, T-013, T-014</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Integration tests validating resilience components working together: circuit breaker with retry, QoS with circuit breaker, full orchestration cycle.</p>
<p><strong>Implementation Notes:</strong>
- Mock HTTP responses to simulate failures
- Verify circuit breaker opens after threshold
- Verify QoS limits concurrent requests
- Verify retry logic with backoff
- Test full failure → recovery cycle
- All tests must run in &lt;60s</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Circuit breaker integration: errors → OPEN → HALF-OPEN → CLOSED
- [ ] QoS integration: concurrent limit enforcement
- [ ] Retry integration: 5xx → backoff → success
- [ ] Full cycle: cache miss → circuit check → QoS → retry → cache write
- [ ] All tests use mocked HTTP (aioresponses)
- [ ] Tests run in &lt;60s</p>
<p><strong>Files to Create:</strong>
- <code>tests/integration/test_resilience_integration.py</code></p>
<p><strong>Effort Breakdown:</strong>
- Circuit breaker integration: 2h
- QoS integration: 1h
- Retry integration: 1h
- Full cycle test: 2h
- Debugging timing issues: 2-4h
- <strong>Total: 8-10h (realistic)</strong></p>
<hr />
<h3 id="t-019-unit-test-suite-completion-tier-1-90">T-019: Unit Test Suite Completion (TIER 1 &gt;90%)<a class="headerlink" href="#t-019-unit-test-suite-completion-tier-1-90" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>12-16 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>All previous tasks</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Complete unit test suite to achieve &gt;90% coverage for TIER 1 components (Circuit Breaker, QoS Router, API Key Sanitization, Atomic Cache Writes) and &gt;80% overall coverage.</p>
<p><strong>Implementation Notes:</strong>
- Focus on TIER 1 components first
- Use pytest-cov to identify gaps
- Write tests for edge cases and error paths
- Mock external dependencies
- Fast execution (&lt;20s for all unit tests)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] &gt;90% coverage: Circuit Breaker, QoS Router, Logging Sanitization, Cache (atomic writes)
- [ ] &gt;80% coverage: Providers, DataLoader, Retry Handler, Health Monitor
- [ ] ~150 unit tests total
- [ ] All tests passing
- [ ] Execution time &lt;20s
- [ ] Coverage report generated (HTML + terminal)</p>
<p><strong>Files to Create/Extend:</strong>
- Extend all existing <code>tests/unit/test_*.py</code> files
- Fill coverage gaps identified by pytest-cov</p>
<p><strong>Effort Breakdown:</strong>
- Coverage analysis: 2h
- Gap filling (TIER 1): 6h
- Gap filling (TIER 2): 4h
- Edge case tests: 3h
- Debugging flaky tests: 2-4h
- <strong>Total: 17-19h (realistic)</strong></p>
<hr />
<h3 id="t-020-e2e-test-scenarios-10-critical-paths">T-020: E2E Test Scenarios (10 critical paths)<a class="headerlink" href="#t-020-e2e-test-scenarios-10-critical-paths" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>8-12 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-016</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement 10 end-to-end test scenarios covering critical user workflows: cache miss → API → cache hit, circuit breaker full cycle, multi-provider parallel fetch, READ-ONLY mode.</p>
<p><strong>Implementation Notes:</strong>
- Mock all HTTP responses (aioresponses)
- Test full DataLoader orchestration
- Verify state changes (cache, circuit breaker, health)
- Each test validates complete workflow
- Tests should run in &lt;30s total</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] 10 E2E tests covering critical scenarios (see TEST_STRATEGY.md Section 8.5)
- [ ] TC-401: Cache miss → API → Cache hit
- [ ] TC-402: READ-ONLY mode enforcement
- [ ] TC-403: Parallel multi-provider fetch
- [ ] TC-404: Health report aggregation
- [ ] Circuit breaker full cycle: OPEN → HALF-OPEN → CLOSED
- [ ] QoS limits concurrent requests
- [ ] All tests mocked (no real API calls)
- [ ] Execution time &lt;30s</p>
<p><strong>Files to Create:</strong>
- <code>tests/e2e/test_happy_path.py</code>
- <code>tests/e2e/test_readonly_mode.py</code>
- <code>tests/e2e/test_parallel_fetch.py</code>
- <code>tests/e2e/test_resilience.py</code></p>
<p><strong>Effort Breakdown:</strong>
- Happy path tests: 3h
- Circuit breaker cycle: 2h
- Parallel fetch: 2h
- READ-ONLY mode: 1h
- Health report: 1h
- Debugging orchestration: 3-5h
- <strong>Total: 12-14h (realistic)</strong></p>
<hr />
<h3 id="t-021-security-tests-api-key-sanitization">T-021: Security Tests (API key sanitization)<a class="headerlink" href="#t-021-security-tests-api-key-sanitization" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>4-6 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-007</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Implement security tests validating API key sanitization in all log output, error messages, and cache files. TIER 1 requirement (TC-101 through TC-106).</p>
<p><strong>Implementation Notes:</strong>
- Test all log levels (DEBUG, INFO, WARNING, ERROR)
- Verify keys redacted in: URLs, headers, error messages
- Verify keys NOT in cache files
- Verify .env in .gitignore
- Use regex patterns to detect key leakage</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] TC-101: Keys not in error messages
- [ ] TC-102: Keys not in success logs
- [ ] TC-103: Keys not in cache files
- [ ] TC-104: .env in .gitignore
- [ ] TC-105: HTTPS enforcement
- [ ] TC-106: TLS validation enabled
- [ ] All security tests passing
- [ ] 100% coverage of security test cases</p>
<p><strong>Files to Create:</strong>
- <code>tests/unit/test_security.py</code>
- <code>tests/integration/test_security_integration.py</code></p>
<p><strong>Effort Breakdown:</strong>
- Log sanitization tests: 2h
- Cache file tests: 1h
- HTTPS/TLS tests: 1h
- .gitignore verification: 0.5h
- Debugging regex patterns: 1-2h
- <strong>Total: 5.5-6.5h (realistic)</strong></p>
<hr />
<h3 id="t-022-coverage-analysis-and-gap-filling">T-022: Coverage Analysis and Gap Filling<a class="headerlink" href="#t-022-coverage-analysis-and-gap-filling" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>4-6 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P0</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-019, T-020</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Analyze coverage reports, identify gaps, and write tests to fill gaps until &gt;80% overall and &gt;90% TIER 1 coverage achieved.</p>
<p><strong>Implementation Notes:</strong>
- Run pytest-cov with HTML report
- Review uncovered lines
- Prioritize TIER 1 gaps
- Write targeted tests for specific branches
- Exclude legitimate uncoverable code (defensive errors, debug code)</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Overall coverage &gt;80%
- [ ] TIER 1 coverage &gt;90%
- [ ] Coverage report generated (HTML)
- [ ] Coverage gaps documented (excluded lines marked)
- [ ] All new tests passing</p>
<p><strong>Files to Create/Extend:</strong>
- Extend existing test files based on gaps</p>
<p><strong>Effort Breakdown:</strong>
- Initial coverage analysis: 1h
- Gap identification: 1h
- Writing gap-filling tests: 3h
- Re-analysis and verification: 1h
- Documentation: 0.5-1h
- <strong>Total: 6.5-7h (realistic)</strong></p>
<hr />
<h3 id="t-023-cicd-pipeline-setup-github-actions">T-023: CI/CD Pipeline Setup (GitHub Actions)<a class="headerlink" href="#t-023-cicd-pipeline-setup-github-actions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>4-6 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P1</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-022</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Set up GitHub Actions workflow for automated testing: lint → type check → unit → integration → E2E → coverage → secret scan.</p>
<p><strong>Implementation Notes:</strong>
- Run on: push to main, pull requests
- Jobs: lint, type-check, test
- Test job runs all test types
- Upload coverage report to codecov or similar
- Secret scanning with detect-secrets
- Cache pip dependencies for speed
- Target execution time: &lt;2 minutes</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] GitHub Actions workflow file created
- [ ] Jobs: lint (ruff), type-check (mypy), test (pytest)
- [ ] Test job runs: unit → integration → E2E
- [ ] Coverage report uploaded
- [ ] Secret scanning runs
- [ ] Badge in README.md
- [ ] Execution time &lt;2 minutes</p>
<p><strong>Files to Create:</strong>
- <code>.github/workflows/ci.yml</code>
- Update <code>README.md</code> with badge</p>
<p><strong>Effort Breakdown:</strong>
- Workflow setup: 2h
- Coverage upload: 1h
- Secret scanning: 1h
- Testing and debugging: 1-2h
- Documentation: 0.5-1h
- <strong>Total: 5.5-7h (realistic)</strong></p>
<hr />
<h3 id="t-024-documentation-polish-readme-examples">T-024: Documentation Polish (README, examples)<a class="headerlink" href="#t-024-documentation-polish-readme-examples" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>6-8 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P1</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>All</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Polish documentation: comprehensive README.md with setup instructions, usage examples, architecture overview, and troubleshooting. Create example scripts demonstrating usage.</p>
<p><strong>Implementation Notes:</strong>
- README sections: Overview, Features, Installation, Quickstart, Examples, Configuration, Architecture, Testing, Contributing
- Example scripts: basic usage, multi-provider fetch, error handling, READ-ONLY mode
- API reference (docstrings already written)
- Troubleshooting common issues
- Link to architecture docs</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] README.md complete with all sections
- [ ] Installation instructions: &lt;5 minute setup
- [ ] Quickstart example: fetch data from all 3 providers
- [ ] Example scripts in <code>examples/</code> directory
- [ ] Configuration documentation (.env variables)
- [ ] Architecture diagram (ASCII or image)
- [ ] Troubleshooting section
- [ ] Links to detailed docs in <code>docs/</code></p>
<p><strong>Files to Create:</strong>
- Update <code>README.md</code>
- <code>examples/quickstart.py</code>
- <code>examples/multi_provider.py</code>
- <code>examples/error_handling.py</code>
- <code>examples/readonly_mode.py</code></p>
<p><strong>Effort Breakdown:</strong>
- README writing: 3h
- Example scripts: 2h
- Architecture diagram: 1h
- Troubleshooting: 1h
- Review and polish: 1-2h
- <strong>Total: 8-9h (realistic)</strong></p>
<hr />
<h3 id="t-025-pre-commit-hooks-secret-scanning">T-025: Pre-commit Hooks (secret scanning)<a class="headerlink" href="#t-025-pre-commit-hooks-secret-scanning" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>2-3 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P1</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>T-007</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Set up pre-commit hooks to automatically scan for API keys and secrets before commits. Prevents accidental key leakage.</p>
<p><strong>Implementation Notes:</strong>
- Use detect-secrets or similar tool
- Configure to scan: <em>.py, </em>.md, <em>.yml, </em>.json
- Exclude: tests/fixtures/ (contains mock data)
- Baseline file for known false positives
- Instructions in README for setup</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] Pre-commit configuration file created
- [ ] detect-secrets hook configured
- [ ] Baseline file for false positives
- [ ] Hook blocks commits with secrets
- [ ] README.md documents setup
- [ ] Tested with actual secret in file</p>
<p><strong>Files to Create:</strong>
- <code>.pre-commit-config.yaml</code>
- <code>.secrets.baseline</code>
- Update <code>README.md</code> with setup instructions</p>
<p><strong>Effort Breakdown:</strong>
- Pre-commit setup: 1h
- Baseline configuration: 0.5h
- Testing: 0.5h
- Documentation: 0.5h
- Debugging: 0.5-1h
- <strong>Total: 3-3.5h (realistic)</strong></p>
<hr />
<h3 id="t-026-manual-smoke-test-with-real-apis">T-026: Manual Smoke Test with Real APIs<a class="headerlink" href="#t-026-manual-smoke-test-with-real-apis" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milestone</strong></td>
<td>M4</td>
</tr>
<tr>
<td><strong>Effort</strong></td>
<td>2-3 hours</td>
</tr>
<tr>
<td><strong>Priority</strong></td>
<td>P1</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>All</td>
</tr>
</tbody>
</table>
<p><strong>Description:</strong>
Manual validation with real API calls to all 3 providers. Verify: authentication works, data fetched, cache written, circuit breaker recovers, health report accurate.</p>
<p><strong>Implementation Notes:</strong>
- Use real API keys (.env file)
- Test representative endpoints from each provider
- Verify cache files created
- Trigger circuit breaker (intentional errors)
- Verify recovery cycle
- Document any discrepancies from mocked tests</p>
<p><strong>Acceptance Criteria:</strong>
- [ ] FMP: fetch profile, quote, historical_price (3 endpoints)
- [ ] Polygon: fetch aggs_daily, market_snapshot (2 endpoints)
- [ ] FRED: fetch CPIAUCSL, UNRATE, DGS10 (3 series)
- [ ] Cache files created in correct paths
- [ ] Circuit breaker opens after failures
- [ ] Circuit breaker recovers
- [ ] Health report shows accurate stats
- [ ] No errors in logs (keys sanitized)
- [ ] Manual test report documented</p>
<p><strong>Files to Create:</strong>
- <code>scripts/manual_smoke_test.py</code>
- <code>docs/MANUAL_TEST_REPORT.md</code></p>
<p><strong>Effort Breakdown:</strong>
- Script creation: 1h
- Test execution: 1h
- Issue investigation: 0.5-1h
- Report writing: 0.5h
- <strong>Total: 3-3.5h (realistic)</strong></p>
<hr />
<h2 id="4-technical-approach">4. Technical Approach<a class="headerlink" href="#4-technical-approach" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Component</th>
<th>Approach</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Config Management</strong></td>
<td>python-dotenv + environment variables</td>
<td>Standard practice; keeps secrets out of code; supports CI override</td>
</tr>
<tr>
<td><strong>HTTP Client</strong></td>
<td>aiohttp.ClientSession (long-lived)</td>
<td>Production-ready async client; connection pooling; timeout control</td>
</tr>
<tr>
<td><strong>Cache</strong></td>
<td>Filesystem JSON with atomic writes (temp+rename)</td>
<td>Simple, inspectable, no DB overhead; atomic writes prevent corruption</td>
</tr>
<tr>
<td><strong>QoS Router</strong></td>
<td>asyncio.Semaphore per provider</td>
<td>Efficient async concurrency control; prevents rate limit violations</td>
</tr>
<tr>
<td><strong>Circuit Breaker</strong></td>
<td>Finite state machine with sliding window</td>
<td>Industry-standard pattern; per-provider isolation; error rate threshold</td>
</tr>
<tr>
<td><strong>Retry Handler</strong></td>
<td>Exponential backoff with jitter</td>
<td>Prevents thundering herd; respects server capacity; fast recovery</td>
</tr>
<tr>
<td><strong>Providers</strong></td>
<td>Plugin architecture (BaseDataProvider)</td>
<td>Extensibility; separation of concerns; consistent interface</td>
</tr>
<tr>
<td><strong>Testing</strong></td>
<td>pytest + pytest-asyncio + aioresponses</td>
<td>Industry standard; excellent async support; reliable HTTP mocking</td>
</tr>
<tr>
<td><strong>Logging</strong></td>
<td>Python logging with rotating file handler</td>
<td>Standard library; API key sanitization via filter; no external deps</td>
</tr>
<tr>
<td><strong>CI/CD</strong></td>
<td>GitHub Actions</td>
<td>Free for public repos; familiar workflow; good Python support</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-file-structure-target">5. File Structure (Target)<a class="headerlink" href="#5-file-structure-target" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>nexus_core/
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>├── .github/
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>│   └── workflows/
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>│       └── ci.yml
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>├── .pre-commit-config.yaml
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>├── .secrets.baseline
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>├── .gitignore
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>├── .env.example
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>├── README.md
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>├── requirements.txt
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>├── requirements-dev.txt
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>├── pyproject.toml (optional - for ruff/mypy config)
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>├── src/
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>│   └── data_loader/
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>│       ├── __init__.py
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>│       ├── loader.py              # DataLoader unified interface
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>│       ├── config.py              # Config Manager
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>│       ├── qos_router.py          # QoS Semaphore Router
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>│       ├── circuit_breaker.py     # Circuit Breaker Manager
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>│       ├── retry.py               # Retry &amp; Backoff Handler
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>│       ├── rate_limit.py          # Rate Limit Handler
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>│       ├── http_client.py         # HTTP Client Layer
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>│       ├── cache.py               # Cache Manager
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>│       ├── health.py              # Health Monitor
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>│       ├── logging_config.py      # Logging with sanitization
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>│       └── providers/
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>│           ├── __init__.py
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>│           ├── base.py            # BaseDataProvider
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>│           ├── fmp.py             # FMP Provider
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>│           ├── polygon.py         # Polygon Provider
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>│           └── fred.py            # FRED Provider
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>├── tests/
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>│   ├── conftest.py                # Shared fixtures
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>│   ├── fixtures/                  # Mock API responses
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>│   │   ├── fmp/
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>│   │   │   ├── profile_AAPL.json
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>│   │   │   ├── quote_MSFT.json
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>│   │   │   └── ... (13 endpoints)
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>│   │   ├── polygon/
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>│   │   │   ├── aggs_daily_SPY.json
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>│   │   │   └── ... (4 endpoints)
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>│   │   └── fred/
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>│   │       ├── CPIAUCSL.json
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>│   │       ├── UNRATE.json
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>│   │       └── ... (sample series)
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>│   ├── unit/                      # Unit tests (~150)
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>│   │   ├── test_config_manager.py
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>│   │   ├── test_http_client.py
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>│   │   ├── test_cache_manager.py
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>│   │   ├── test_health_monitor.py
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>│   │   ├── test_base_provider.py
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>│   │   ├── test_fmp_provider.py
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>│   │   ├── test_polygon_provider.py
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>│   │   ├── test_fred_provider.py
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>│   │   ├── test_qos_router.py
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>│   │   ├── test_circuit_breaker.py
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>│   │   ├── test_retry_handler.py
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>│   │   ├── test_rate_limit.py
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>│   │   ├── test_loader.py
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>│   │   ├── test_logging_sanitization.py
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>│   │   └── test_security.py
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>│   ├── integration/               # Integration tests (~40)
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>│   │   ├── test_fmp_integration.py
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>│   │   ├── test_polygon_integration.py
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>│   │   ├── test_fred_integration.py
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>│   │   ├── test_cache_filesystem.py
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>│   │   ├── test_circuit_breaker_integration.py
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>│   │   ├── test_resilience_integration.py
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>│   │   ├── test_loader_integration.py
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>│   │   ├── test_logging_integration.py
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>│   │   └── test_security_integration.py
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>│   └── e2e/                       # E2E tests (~10)
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>│       ├── test_happy_path.py
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>│       ├── test_readonly_mode.py
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>│       ├── test_parallel_fetch.py
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>│       └── test_resilience.py
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>├── examples/
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>│   ├── quickstart.py
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>│   ├── multi_provider.py
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>│   ├── error_handling.py
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>│   └── readonly_mode.py
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>├── scripts/
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>│   ├── manual_smoke_test.py
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>│   └── record_fixtures.py (for updating test fixtures)
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>├── docs/
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>│   ├── REQUIREMENTS.md
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>│   ├── ARCHITECTURE.md
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>│   ├── SECURITY.md
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>│   ├── TEST_STRATEGY.md
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>│   ├── DECISIONS.md
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>│   ├── ACTION_PLAN.md (this document)
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>│   └── MANUAL_TEST_REPORT.md
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>├── data/                          # Cache storage (excluded from git)
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>│   ├── fmp_cache/
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>│   ├── polygon_cache/
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>│   └── fred_cache/
<a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>└── logs/                          # Log files (excluded from git)
<a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>    └── nexus_core.log
</code></pre></div>
<hr />
<h2 id="6-dependencies-to-install">6. Dependencies to Install<a class="headerlink" href="#6-dependencies-to-install" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Package</th>
<th>Version</th>
<th>Purpose</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>aiohttp</strong></td>
<td>&gt;=3.8.0</td>
<td>Async HTTP client</td>
<td>Runtime</td>
</tr>
<tr>
<td><strong>python-dotenv</strong></td>
<td>&gt;=0.19.0</td>
<td>.env file loading</td>
<td>Runtime</td>
</tr>
<tr>
<td><strong>pytest</strong></td>
<td>&gt;=7.0.0</td>
<td>Testing framework</td>
<td>Dev</td>
</tr>
<tr>
<td><strong>pytest-cov</strong></td>
<td>&gt;=3.0.0</td>
<td>Coverage reporting</td>
<td>Dev</td>
</tr>
<tr>
<td><strong>pytest-asyncio</strong></td>
<td>&gt;=0.21.0</td>
<td>Async test support</td>
<td>Dev</td>
</tr>
<tr>
<td><strong>aioresponses</strong></td>
<td>&gt;=0.7.0</td>
<td>HTTP mocking</td>
<td>Dev</td>
</tr>
<tr>
<td><strong>mypy</strong></td>
<td>&gt;=1.0.0</td>
<td>Type checking</td>
<td>Dev</td>
</tr>
<tr>
<td><strong>ruff</strong></td>
<td>latest</td>
<td>Linting</td>
<td>Dev</td>
</tr>
<tr>
<td><strong>detect-secrets</strong></td>
<td>&gt;=1.4.0</td>
<td>Secret scanning</td>
<td>Dev</td>
</tr>
</tbody>
</table>
<p><strong>Installation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Runtime dependencies</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>pip<span class="w"> </span>install<span class="w"> </span>aiohttp&gt;<span class="o">=</span><span class="m">3</span>.8.0<span class="w"> </span>python-dotenv&gt;<span class="o">=</span><span class="m">0</span>.19.0
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># Development dependencies</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest&gt;<span class="o">=</span><span class="m">7</span>.0.0<span class="w"> </span>pytest-cov&gt;<span class="o">=</span><span class="m">3</span>.0.0<span class="w"> </span>pytest-asyncio&gt;<span class="o">=</span><span class="m">0</span>.21.0<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">            </span>aioresponses&gt;<span class="o">=</span><span class="m">0</span>.7.0<span class="w"> </span>mypy&gt;<span class="o">=</span><span class="m">1</span>.0.0<span class="w"> </span>ruff<span class="w"> </span>detect-secrets&gt;<span class="o">=</span><span class="m">1</span>.4.0
</code></pre></div></p>
<hr />
<h2 id="7-risk-mitigation">7. Risk Mitigation<a class="headerlink" href="#7-risk-mitigation" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Probability</th>
<th>Impact</th>
<th>Mitigation</th>
<th>Buffer</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Effort underestimation</strong></td>
<td>HIGH</td>
<td>HIGH</td>
<td>Applied 2-3x multipliers; built-in buffer per task</td>
<td>+20% contingency</td>
</tr>
<tr>
<td><strong>API schema changes</strong></td>
<td>MEDIUM</td>
<td>MEDIUM</td>
<td>Schema validation with warnings; version fixtures; graceful degradation</td>
<td>+4h for fixture updates</td>
</tr>
<tr>
<td><strong>Async timing bugs</strong></td>
<td>MEDIUM</td>
<td>MEDIUM</td>
<td>Comprehensive unit tests; integration tests with mocks; manual smoke test</td>
<td>+8h debugging budget</td>
</tr>
<tr>
<td><strong>Coverage gaps</strong></td>
<td>MEDIUM</td>
<td>LOW</td>
<td>Dedicated gap-filling task (T-022); prioritize TIER 1 first</td>
<td>+6h for stubborn gaps</td>
</tr>
<tr>
<td><strong>Testing complexity</strong></td>
<td>MEDIUM</td>
<td>MEDIUM</td>
<td>Mock all HTTP; use fixtures; test in isolation first</td>
<td>+12h for flaky tests</td>
</tr>
<tr>
<td><strong>Scope creep</strong></td>
<td>LOW</td>
<td>HIGH</td>
<td>Strict adherence to DECISIONS.md; defer all "nice to have" features</td>
<td>Milestone review gates</td>
</tr>
<tr>
<td><strong>Burnout</strong></td>
<td>MEDIUM</td>
<td>CRITICAL</td>
<td>Sustainable pace (8-10h/week); no hard deadlines; flexible schedule</td>
<td>Built into timeline</td>
</tr>
</tbody>
</table>
<p><strong>Contingency Budget:</strong> +50 hours (20% of total) for unknowns, debugging, and iteration.</p>
<hr />
<h2 id="8-quality-checkpoints">8. Quality Checkpoints<a class="headerlink" href="#8-quality-checkpoints" title="Permanent link">&para;</a></h2>
<h3 id="per-task">Per Task<a class="headerlink" href="#per-task" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Code complete and working</li>
<li>[ ] Unit tests written and passing</li>
<li>[ ] Lint clean (ruff: 0 errors)</li>
<li>[ ] Type check passing (mypy: 0 errors)</li>
<li>[ ] Task acceptance criteria met</li>
</ul>
<h3 id="per-milestone">Per Milestone<a class="headerlink" href="#per-milestone" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] All milestone tasks complete</li>
<li>[ ] Integration tests passing</li>
<li>[ ] Milestone success criteria met</li>
<li>[ ] Self-review complete</li>
<li>[ ] Documentation updated</li>
</ul>
<h3 id="final-m4-complete">Final (M4 Complete)<a class="headerlink" href="#final-m4-complete" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Overall coverage &gt;80%</li>
<li>[ ] TIER 1 coverage &gt;90%</li>
<li>[ ] All ~200 tests passing</li>
<li>[ ] CI pipeline green</li>
<li>[ ] All critical test cases (TC-001 to TC-106) passing</li>
<li>[ ] No API keys in logs/cache/git</li>
<li>[ ] Manual smoke test successful</li>
<li>[ ] README.md complete</li>
<li>[ ] Pre-commit hooks working</li>
</ul>
<hr />
<h2 id="9-commands-for-claude-code">9. Commands for Claude Code<a class="headerlink" href="#9-commands-for-claude-code" title="Permanent link">&para;</a></h2>
<h3 id="project-setup-t-001">Project Setup (T-001)<a class="headerlink" href="#project-setup-t-001" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Create directory structure</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>src/data_loader/providers
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>tests/<span class="o">{</span>unit,integration,e2e,fixtures/<span class="o">{</span>fmp,polygon,fred<span class="o">}}</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>docs<span class="w"> </span>examples<span class="w"> </span>scripts<span class="w"> </span>data<span class="w"> </span>logs
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="c1"># Initialize git</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>git<span class="w"> </span>init
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="c1"># Create virtual environment</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>python3.9<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w">  </span><span class="c1"># On Windows: venv\Scripts\activate</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="c1"># Install dependencies</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>pip<span class="w"> </span>install<span class="w"> </span>aiohttp&gt;<span class="o">=</span><span class="m">3</span>.8.0<span class="w"> </span>python-dotenv&gt;<span class="o">=</span><span class="m">0</span>.19.0
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest&gt;<span class="o">=</span><span class="m">7</span>.0.0<span class="w"> </span>pytest-cov&gt;<span class="o">=</span><span class="m">3</span>.0.0<span class="w"> </span>pytest-asyncio&gt;<span class="o">=</span><span class="m">0</span>.21.0<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">            </span>aioresponses&gt;<span class="o">=</span><span class="m">0</span>.7.0<span class="w"> </span>mypy&gt;<span class="o">=</span><span class="m">1</span>.0.0<span class="w"> </span>ruff<span class="w"> </span>detect-secrets&gt;<span class="o">=</span><span class="m">1</span>.4.0
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="c1"># Create requirements files</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="c1"># Verify installation</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import aiohttp; import dotenv; print(&#39;OK&#39;)&quot;</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>pytest<span class="w"> </span>--version
</code></pre></div>
<h3 id="run-tests">Run Tests<a class="headerlink" href="#run-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Run all tests</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>pytest
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># Run specific test type</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>pytest<span class="w"> </span>-m<span class="w"> </span>unit<span class="w">          </span><span class="c1"># Unit tests only</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>pytest<span class="w"> </span>-m<span class="w"> </span>integration<span class="w">   </span><span class="c1"># Integration tests only</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>pytest<span class="w"> </span>-m<span class="w"> </span>e2e<span class="w">          </span><span class="c1"># E2E tests only</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1"># Run with coverage</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>pytest<span class="w"> </span>--cov<span class="o">=</span>src<span class="w"> </span>--cov-report<span class="o">=</span>html<span class="w"> </span>--cov-report<span class="o">=</span>term-missing
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="c1"># Run fast tests only</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>pytest<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;not slow&quot;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="c1"># Run TIER 1 tests</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>pytest<span class="w"> </span>-m<span class="w"> </span>tier1
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="c1"># Run specific file</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>pytest<span class="w"> </span>tests/unit/test_circuit_breaker.py<span class="w"> </span>-v
</code></pre></div>
<h3 id="lint-and-type-check">Lint and Type Check<a class="headerlink" href="#lint-and-type-check" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Lint</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>ruff<span class="w"> </span>check<span class="w"> </span>src/<span class="w"> </span>tests/
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># Type check</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>mypy<span class="w"> </span>src/
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># Fix auto-fixable lint issues</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>ruff<span class="w"> </span>check<span class="w"> </span>--fix<span class="w"> </span>src/<span class="w"> </span>tests/
</code></pre></div>
<h3 id="coverage-analysis">Coverage Analysis<a class="headerlink" href="#coverage-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Generate HTML coverage report</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>pytest<span class="w"> </span>--cov<span class="o">=</span>src<span class="w"> </span>--cov-report<span class="o">=</span>html
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>open<span class="w"> </span>htmlcov/index.html
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="c1"># Check coverage threshold</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>pytest<span class="w"> </span>--cov<span class="o">=</span>src<span class="w"> </span>--cov-fail-under<span class="o">=</span><span class="m">80</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="c1"># Coverage for specific component (TIER 1)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>pytest<span class="w"> </span>--cov<span class="o">=</span>src/data_loader/circuit_breaker.py<span class="w"> </span>--cov-report<span class="o">=</span>term
</code></pre></div>
<h3 id="pre-commit-setup">Pre-commit Setup<a class="headerlink" href="#pre-commit-setup" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Install pre-commit hooks</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>pre-commit<span class="w"> </span>install
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1"># Run hooks manually</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c1"># Update hooks</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>pre-commit<span class="w"> </span>autoupdate
</code></pre></div>
<hr />
<h2 id="10-definition-of-done">10. Definition of Done<a class="headerlink" href="#10-definition-of-done" title="Permanent link">&para;</a></h2>
<p>A task is <strong>DONE</strong> when:</p>
<ul>
<li>[ ] Code complete and working</li>
<li>[ ] All task acceptance criteria met</li>
<li>[ ] Unit tests written and passing (per tier requirements)</li>
<li>[ ] Lint passing (ruff: 0 errors)</li>
<li>[ ] Type check passing (mypy: 0 errors)</li>
<li>[ ] Integration tests passing (if applicable)</li>
<li>[ ] Documentation updated (docstrings, README)</li>
<li>[ ] Self-review complete (code quality check)</li>
<li>[ ] No known bugs or regressions</li>
</ul>
<p>A milestone is <strong>DONE</strong> when:</p>
<ul>
<li>[ ] All milestone tasks DONE</li>
<li>[ ] Milestone success criteria met</li>
<li>[ ] Integration tests passing</li>
<li>[ ] Coverage targets met (if M4)</li>
<li>[ ] Documentation complete</li>
</ul>
<p>The project is <strong>DONE</strong> when:</p>
<ul>
<li>[ ] All 4 milestones complete</li>
<li>[ ] Overall coverage &gt;80%, TIER 1 &gt;90%</li>
<li>[ ] All ~200 tests passing (&lt;2 min execution)</li>
<li>[ ] CI pipeline green</li>
<li>[ ] All critical test cases passing (TC-001 to TC-106)</li>
<li>[ ] Security tests passing (no API keys leaked)</li>
<li>[ ] Manual smoke test successful (real APIs)</li>
<li>[ ] README.md complete (&lt;5 min setup instructions)</li>
<li>[ ] Pre-commit hooks working</li>
<li>[ ] All 14 MUST requirements implemented</li>
<li>[ ] No P0 bugs or issues</li>
</ul>
<hr />
<h2 id="approval">Approval<a class="headerlink" href="#approval" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Role</th>
<th>Name</th>
<th>Date</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Author</td>
<td>Lead Agent</td>
<td>2026-01-31</td>
<td>Generated</td>
</tr>
<tr>
<td>Owner</td>
<td>Solo Developer</td>
<td></td>
<td>Pending</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="revision-history">Revision History<a class="headerlink" href="#revision-history" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>2026-01-31</td>
<td>Lead Agent</td>
<td>Initial action plan with realistic effort estimates</td>
</tr>
</tbody>
</table>
<hr />
<p><strong>Reality Check Applied:</strong></p>
<p>This plan reflects realistic effort estimates with 2-3x multipliers on initial estimates. Solo developer working 8-10 hours/week can complete in 5-7 weeks at sustainable pace. NO hard deadlines. Quality over speed.</p>
<p>Key realism factors:
- "Add tests" tasks are 8-16h (not "2h")
- Complex components (Circuit Breaker, FMP Provider) get realistic time budgets
- Debugging and iteration time explicitly included
- 20% contingency buffer for unknowns
- Focus on TIER 1 components first (&gt;90% coverage)
- Accept TIER 3 at 60% (proportionate to risk)</p>
<p><strong>This is a research tool, not a production system. Build it right, not fast.</strong></p>
<hr />
<h2 id="11-next-steps-post-completion">11. Next Steps (Post-Completion)<a class="headerlink" href="#11-next-steps-post-completion" title="Permanent link">&para;</a></h2>
<p>A projekt alapvető funkcionalitása kész (M1-M4 ✅). A következő opcionális fejlesztések érhetők el:</p>
<h3 id="111-dokumentacio-kiegeszitese">11.1 Dokumentáció kiegészítése<a class="headerlink" href="#111-dokumentacio-kiegeszitese" title="Permanent link">&para;</a></h3>
<p><strong>Prioritás:</strong> Magas | <strong>Komplexitás:</strong> Közepes</p>
<ul>
<li>[ ] README.md frissítése</li>
<li>Telepítési útmutató</li>
<li>Használati példák (basic, advanced)</li>
<li>API referencia összefoglaló</li>
<li>Troubleshooting szekció</li>
<li>[ ] API dokumentáció generálása</li>
<li>Sphinx vagy mkdocs választás</li>
<li>Docstring-ek ellenőrzése</li>
<li>Hosted docs (GitHub Pages / ReadTheDocs)</li>
</ul>
<h3 id="112-csomagolas-es-publikalas">11.2 Csomagolás és publikálás<a class="headerlink" href="#112-csomagolas-es-publikalas" title="Permanent link">&para;</a></h3>
<p><strong>Prioritás:</strong> Magas | <strong>Komplexitás:</strong> Közepes</p>
<ul>
<li>[ ] pyproject.toml kiegészítése</li>
<li>Build system (hatchling/setuptools)</li>
<li>Entry points</li>
<li>Dependencies specifikáció</li>
<li>[ ] PyPI feltöltés előkészítése</li>
<li>Package name ellenőrzés</li>
<li>Verziókezelés stratégia (semver)</li>
<li>CHANGELOG.md létrehozása</li>
<li>[ ] Distribution tesztelés</li>
<li>TestPyPI feltöltés</li>
<li>Clean install teszt</li>
</ul>
<h3 id="113-integracios-tesztek-valos-api-kkal">11.3 Integrációs tesztek valós API-kkal<a class="headerlink" href="#113-integracios-tesztek-valos-api-kkal" title="Permanent link">&para;</a></h3>
<p><strong>Prioritás:</strong> Közepes | <strong>Komplexitás:</strong> Közepes</p>
<ul>
<li>[ ] FMP integráció tesztelése (éles API kulccsal)</li>
<li>[ ] Polygon integráció tesztelése</li>
<li>[ ] FRED integráció tesztelése</li>
<li>[ ] Cross-provider tesztek (párhuzamos lekérdezések)</li>
</ul>
<h3 id="114-tovabbi-fejlesztesek">11.4 További fejlesztések<a class="headerlink" href="#114-tovabbi-fejlesztesek" title="Permanent link">&para;</a></h3>
<p><strong>Prioritás:</strong> Alacsony | <strong>Komplexitás:</strong> Magas</p>
<ul>
<li>[ ] Új provider: Alpha Vantage</li>
<li>[ ] Új provider: Yahoo Finance</li>
<li>[ ] Rate limiting finomhangolás (adaptive)</li>
<li>[ ] Webhook/callback támogatás</li>
</ul>
<h3 id="115-production-hasznalat">11.5 Production használat<a class="headerlink" href="#115-production-hasznalat" title="Permanent link">&para;</a></h3>
<p><strong>Státusz:</strong> ✅ KÉSZEN ÁLL</p>
<p>A projekt production-ready:
- 441 teszt passing
- 92% code coverage
- CI/CD pipeline aktív
- Security tesztek (API key sanitization)
- HTTPS enforced
- Circuit breaker védelem</p>
<hr />
<h2 id="revision-history_1">Revision History<a class="headerlink" href="#revision-history_1" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>2026-01-31</td>
<td>Lead Agent</td>
<td>Initial action plan with realistic effort estimates</td>
</tr>
<tr>
<td>1.1</td>
<td>2026-01-31</td>
<td>Claude</td>
<td>Updated status: M1-M4 COMPLETE, added Next Steps section</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Maeshowe/Nexus_Core" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>